<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>this | ryo</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/fairy.png">
    <meta name="description" content="join">
    <meta name="ryo" content="ryo,ryo,ryo">
    
    <link rel="preload" href="/assets/css/0.styles.9e6304f0.css" as="style"><link rel="preload" href="/assets/js/app.fcebdc86.js" as="script"><link rel="preload" href="/assets/js/2.566d03f3.js" as="script"><link rel="preload" href="/assets/js/27.defabb34.js" as="script"><link rel="prefetch" href="/assets/js/10.fff00b3c.js"><link rel="prefetch" href="/assets/js/11.b639eee2.js"><link rel="prefetch" href="/assets/js/12.bc1c2fa8.js"><link rel="prefetch" href="/assets/js/13.b53d91e4.js"><link rel="prefetch" href="/assets/js/14.f194fdfd.js"><link rel="prefetch" href="/assets/js/15.5d958d5d.js"><link rel="prefetch" href="/assets/js/16.886c5d0b.js"><link rel="prefetch" href="/assets/js/17.83f99b76.js"><link rel="prefetch" href="/assets/js/18.0bff795e.js"><link rel="prefetch" href="/assets/js/19.63f91aab.js"><link rel="prefetch" href="/assets/js/20.0c95b34b.js"><link rel="prefetch" href="/assets/js/21.946c0a30.js"><link rel="prefetch" href="/assets/js/22.535b1bdf.js"><link rel="prefetch" href="/assets/js/23.3be09670.js"><link rel="prefetch" href="/assets/js/24.24474c19.js"><link rel="prefetch" href="/assets/js/25.fe2b31ea.js"><link rel="prefetch" href="/assets/js/26.1225d133.js"><link rel="prefetch" href="/assets/js/28.6328c73a.js"><link rel="prefetch" href="/assets/js/29.6a86c84b.js"><link rel="prefetch" href="/assets/js/3.e509b4f9.js"><link rel="prefetch" href="/assets/js/30.2a5d9f27.js"><link rel="prefetch" href="/assets/js/31.d15853af.js"><link rel="prefetch" href="/assets/js/32.1e644616.js"><link rel="prefetch" href="/assets/js/33.ea4f20f2.js"><link rel="prefetch" href="/assets/js/34.b699b537.js"><link rel="prefetch" href="/assets/js/35.00b3d549.js"><link rel="prefetch" href="/assets/js/36.4e3a1641.js"><link rel="prefetch" href="/assets/js/37.55fdbf51.js"><link rel="prefetch" href="/assets/js/38.115bcf1f.js"><link rel="prefetch" href="/assets/js/39.b041f9c9.js"><link rel="prefetch" href="/assets/js/4.fda49616.js"><link rel="prefetch" href="/assets/js/40.2b3100db.js"><link rel="prefetch" href="/assets/js/41.dc86b1d3.js"><link rel="prefetch" href="/assets/js/42.010af515.js"><link rel="prefetch" href="/assets/js/43.91df7ae4.js"><link rel="prefetch" href="/assets/js/44.c16eb3f3.js"><link rel="prefetch" href="/assets/js/45.d9abd564.js"><link rel="prefetch" href="/assets/js/46.33b7f377.js"><link rel="prefetch" href="/assets/js/47.e88207c0.js"><link rel="prefetch" href="/assets/js/48.abd61fe2.js"><link rel="prefetch" href="/assets/js/49.bf28235d.js"><link rel="prefetch" href="/assets/js/5.22c996e1.js"><link rel="prefetch" href="/assets/js/50.2d9b8b1f.js"><link rel="prefetch" href="/assets/js/51.2cef74ff.js"><link rel="prefetch" href="/assets/js/52.229b380c.js"><link rel="prefetch" href="/assets/js/53.aacc71d8.js"><link rel="prefetch" href="/assets/js/54.7e3a0520.js"><link rel="prefetch" href="/assets/js/55.957ce5c3.js"><link rel="prefetch" href="/assets/js/56.ae5b8e61.js"><link rel="prefetch" href="/assets/js/57.5a225a8c.js"><link rel="prefetch" href="/assets/js/58.3aa25414.js"><link rel="prefetch" href="/assets/js/59.3f14ab0b.js"><link rel="prefetch" href="/assets/js/6.237d497a.js"><link rel="prefetch" href="/assets/js/60.ecc75ef2.js"><link rel="prefetch" href="/assets/js/61.d7399b09.js"><link rel="prefetch" href="/assets/js/62.f01d4895.js"><link rel="prefetch" href="/assets/js/63.6b1867fa.js"><link rel="prefetch" href="/assets/js/64.b39febb3.js"><link rel="prefetch" href="/assets/js/65.e5eff485.js"><link rel="prefetch" href="/assets/js/66.32cc1508.js"><link rel="prefetch" href="/assets/js/67.59570350.js"><link rel="prefetch" href="/assets/js/68.f78c37ee.js"><link rel="prefetch" href="/assets/js/69.8d6bdd89.js"><link rel="prefetch" href="/assets/js/7.56c24b91.js"><link rel="prefetch" href="/assets/js/70.281cabb8.js"><link rel="prefetch" href="/assets/js/71.fe51c4b9.js"><link rel="prefetch" href="/assets/js/72.a3714701.js"><link rel="prefetch" href="/assets/js/8.895aecf6.js"><link rel="prefetch" href="/assets/js/9.3102dc66.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9e6304f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ryo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/computer/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/bookmarks/" class="nav-link">
  书签
</a></div><div class="nav-item"><a href="/play/" class="nav-link">
  娱乐
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="lang" class="dropdown-title"><span class="title">lang</span> <span class="arrow down"></span></button> <button type="button" aria-label="lang" class="mobile-dropdown-title"><span class="title">lang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/English.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><h4>
          中文
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/简体中文.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-subitem"><a href="/language/繁体中文.html" class="nav-link">
  繁体中文
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/computer/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/bookmarks/" class="nav-link">
  书签
</a></div><div class="nav-item"><a href="/play/" class="nav-link">
  娱乐
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="lang" class="dropdown-title"><span class="title">lang</span> <span class="arrow down"></span></button> <button type="button" aria-label="lang" class="mobile-dropdown-title"><span class="title">lang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/English.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><h4>
          中文
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/简体中文.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-subitem"><a href="/language/繁体中文.html" class="nav-link">
  繁体中文
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发</span> <!----></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>element_ui</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/computer/JavaScript/class.html" class="sidebar-link">class 类</a></li><li><a href="/computer/JavaScript/DOM事件.html" class="sidebar-link">事件</a></li><li><a href="/computer/JavaScript/DOM事件名称.html" class="sidebar-link">事件名称</a></li><li><a href="/computer/JavaScript/es6.html" class="sidebar-link">ES6</a></li><li><a href="/computer/JavaScript/promise.html" class="sidebar-link">Promise</a></li><li><a href="/computer/JavaScript/Symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/computer/JavaScript/this.html" aria-current="page" class="active sidebar-link">this</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/computer/JavaScript/this.html#call-、apply-、bind" class="sidebar-link">call()、apply()、bind()</a></li><li class="sidebar-sub-header"><a href="/computer/JavaScript/this.html#javascript深入理解this关键字-二" class="sidebar-link">JavaScript深入理解this关键字(二)</a></li></ul></li><li><a href="/computer/JavaScript/事件.html" class="sidebar-link">事件</a></li><li><a href="/computer/JavaScript/八段代码彻底掌握 Promise.html" class="sidebar-link">八段代码彻底掌握 Promise</a></li><li><a href="/computer/JavaScript/函数.html" class="sidebar-link">函数</a></li><li><a href="/computer/JavaScript/变量.html" class="sidebar-link">变量</a></li><li><a href="/computer/JavaScript/字符串.html" class="sidebar-link">字符串</a></li><li><a href="/computer/JavaScript/对象.html" class="sidebar-link">对象</a></li><li><a href="/computer/JavaScript/常用方法.html" class="sidebar-link">js截取url中?后面的数据，并转化成对象</a></li><li><a href="/computer/JavaScript/数组.html" class="sidebar-link">数组</a></li><li><a href="/computer/JavaScript/杂项.html" class="sidebar-link">杂项</a></li><li><a href="/computer/JavaScript/逻辑运算符.html" class="sidebar-link">逻辑运算符</a></li><li><a href="/computer/JavaScript/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/computer/开发技巧/JavaScript技巧1.html" class="sidebar-link">JavaScript技巧1</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>uni_app</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发常用网站</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架&amp;库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="this"><a href="#this" class="header-anchor">#</a> this</h1> <p>明确的说，this不会以任何方式指向函数的词法作用域，作用域好像是一个将所有可用标识符作为属性的对象，这从内部来说他是对的，但是JavaScript代码不能访问这个作用域“对象”，因为它是引擎内部的实现</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> john <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'john'</span><span class="token punctuation">,</span>
    yearOfBirth<span class="token operator">:</span> <span class="token number">1990</span><span class="token punctuation">,</span>
    <span class="token function-variable function">calculateAge</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//john</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2016</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>yearOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//windows</span>
        <span class="token punctuation">}</span>
        <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

john<span class="token punctuation">.</span><span class="token function">calculateAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>calculateAge</code>函数内部， <code>this</code> 指向 <code>john</code>对象，但是，在<code>innerFunction</code>函数内部，<code>this</code>指向全局对象（本例中为<code>window</code>），有些人认为这是<code>JS</code>的bug，但是规则告诉我们<strong>无论何时一个普通函数被调用时，那么<code>this</code>将指向全局对象。</strong></p> <blockquote><p>当函数<strong>不作为对象的属性</strong>被调用时，也就是我们常说的普通函数方式，此时的this总是指  向全局对象。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'小王'</span>
    <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">17</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'小张'</span><span class="token punctuation">,</span>
      objage<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span>
      <span class="token function-variable function">fun</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>objage<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//17</span>
    obj<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token comment">//小张  undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当一个函数被调用时，应该立马看<code>()</code>左边的部分。</p> <ul><li>如果<code>()</code>左边是一个引用(reference),那么，函数的<code>this</code>指向的就是这个引用所属的对象</li> <li>否则<code>this</code>指向的就是全局对象(window|global)</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// global - because the method bar() belongs to the global object when invoked</span>
<span class="token comment">// 这里，this指向的是全局对象。我们先看()的左边，是bar,</span>
<span class="token comment">// 那么bar属于谁呢？bar属于全局对象，所以this指向的就是全局对象。</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">baz</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
foo<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo - because the method baz() belongs to the object foo when invoked</span>
<span class="token comment">// 这里,this指向的是foo,先看()左边是baz，baz属于foo，所以baz里的this指向的就是foo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="引子"><a href="#引子" class="header-anchor">#</a> 引子</h4> <p>在JavaScript中<code>this</code>的指向总是让人很困惑，它到底指的啥？为了彻底弄清它,我们就来探讨一下吧。<code>this</code>在不同的执行环境，不同的用法下会有所不同，以下分几种情况，讨论<code>this</code>的指向。</p> <h4 id="this指向分类讨论"><a href="#this指向分类讨论" class="header-anchor">#</a> this指向分类讨论</h4> <h5 id="this在全局作用域中"><a href="#this在全局作用域中" class="header-anchor">#</a> this在全局作用域中</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>// global scope

foo = 'abc';
alert(foo); // abc

this.foo = 'def';
alert(foo); // def
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在全局作用域/全局环境(global scope| global context)中，<code>this</code>指向的就是全局变量</p> <ul><li>在浏览器里,指向<code>window</code>对象</li> <li>在Node.js里，指向<code>global</code>对象</li></ul> <h5 id="this在函数-function-里"><a href="#this在函数-function-里" class="header-anchor">#</a> this在函数(function)里</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>var boat = {
    size: 'normal',
    boatInfo: function() {
        alert(this === boat);
        alert(this.size);
    }
};

boat.boatInfo(); // true, 'normal'

var bigBoat = {
    size: 'big'
};

bigBoat.boatInfo = boat.boatInfo;
bigBoat.boatInfo(); // false, 'big'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上面这段代码里，<code>this</code>指向谁？可以看到，<code>boat</code>对象有一个<code>size</code>属性，和一个<code>boatInfo()</code>方法。在<code>boatInfo()</code>方法里，alert出<code>this</code>是否和<code>boat</code>相等，以及<code>this</code>所指向的size属性。</p> <p>当我们去用<code>boat.boatInfo()</code>时，可以看到，<code>this</code>和<code>boat</code>是相等的,<code>this.size</code>的值就是<code>boat.size</code>的值nomal</p> <p>当我们创建一个新的对象，<code>bigBoat</code>,它的<code>size</code>属性为big，但是<code>bigBoat</code>这个对象没有<code>boatInfo()</code>方法，于是我们把<code>boat.boatInfo()</code>的方法赋给了它。然后我们调用<code>bigBoat.boatInfo()</code>,发现<code>this</code>不等于<code>boat</code>,<code>this.size</code>的值为big</p> <p><code>this</code>的指向改变了！</p> <blockquote><p>The first thing you must realise is that the value of this inside any function is never static, it is always determined every time you call a function, but before the function actually executes it’s code. The value of this inside a function is actually provided by the parent scope in which the function was called, and more importantly, how the actual function syntax was written.</p></blockquote> <p>要理解以上的变化，首先要明白，在任何函数中，<code>this</code>的指向都不是静态的(static)。它总是在你调用一个函数，但尚未执行函数内部代码前被指定。(查看参考链接中的执行环境的文章，这个阶段，实际就是初始化变量对象，在初始化变量对象的时候，确定了this的指向)实际上，this是 被调用的函数的父作用域 提供的，更重要的是，我们要看看函数调用时是怎么写的。</p> <p>当一个函数被调用时，应该立马看<code>()</code>左边的部分。</p> <ul><li>如果<code>()</code>左边是一个引用(reference),那么，函数的<code>this</code>指向的就是这个引用所属的对象</li> <li>否则<code>this</code>指向的就是全局对象(window|global)</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>function bar() {
    alert(this);
}
bar(); // global - because the method bar() belongs to the global object when invoked
// 这里，this指向的是全局对象。我们先看()的左边，是bar,
// 那么bar属于谁呢？bar属于全局对象，所以this指向的就是全局对象。

var foo = {
    baz: function() {
        alert(this);
    }
}
foo.baz(); // foo - because the method baz() belongs to the object foo when invoked
// 这里,this指向的是foo,先看()左边是baz，baz属于foo，所以baz里的this指向的就是foo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如果代码都那么简单，那么<code>this</code>的指向也就简单明了了。来点复杂点的看看:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var foo = {
    baz: function() {
        alert(this);
    }
}
foo.baz(); // foo - because baz belongs to the foo object when invoked

var anotherBaz = foo.baz;
anotherBaz(); // global - because the method anotherBaz() belongs to the global object when invoked, NOT foo
// this指向全局对象，()左边是anotherBaz,属于全局对象
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以看到<code>baz()</code>中<code>this</code>的指向老是变来变去的。再来看看嵌套在对象里的<code>this</code>的指向</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var anum = 0;

var foo = {
    anum: 10,
    baz: {
        anum: 20,
        bar: function() {
            console.log(this.anum);
        }
    }
}
foo.baz.bar(); // 20 - because left side of () is bar, which belongs to baz object when invoked
// ()左边是bar，bar属于foo.baz，所以this就是foo.baz,this.anum = foo.baz.anum = 20

var hello = foo.baz.bar;
hello(); // 0 - because left side of () is hello, which belongs to global object when invoked
// ()左边是hello，hello属于全局对象，所以this指向全局对象，this.anum = window.anum = 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>再来看个例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const obj = {
  name: 'spike',
  friends: ['deer', 'cat'],
  loop: function() {
    this.friends.forEach( // 这个this指向obj
      function( friend ) {
        console.log(`${this.name} knows ${friend}`);
        console.log(this === global); // 在node.js环境下，全局对象为global
      }
    )
  }
}

obj.loop();
// ()左边是loop,属于obj,所以loop函数中的this指向obj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>输出</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ node test
undefined knows dear
true
undefined knows cat
true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到，在forEach中的this并不是期待的那样指向obj，而是指向全局对象了</p> <p>可以用上面提到的，还是看<code>()</code>左边，在forEach中，<code>()</code>左边是function，而不是一个引用, 所以this指向的就是全局对象</p> <p>这里其实我也有点迷惑，当不明白Scope的结构时候，可以通过在浏览器中运行代码，去调试面板查看函数执行时的作用域变化。</p> <h5 id="在构造函数里的this指向"><a href="#在构造函数里的this指向" class="header-anchor">#</a> 在构造函数里的this指向</h5> <p>当使用<code>new</code>关键字去执行构造函数时，构造函数中的<code>this</code>指向的的就是新建的那个对象实例。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  var savedThis;
    function Constr() {
        // 保存构造函数中的this
        savedThis = this;
    }
    // 通过new关键字执行构造函数
    var inst = new Constr();
    
    // 构造函数中的this指向的就是新创建的对象实例inst
    console.log(savedThis === inst); // true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果你没有用<code>new</code>关键字去执行构造函数，那么就要分析函数被调用时所属的作用域了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    function Point(x, y) {
        this.x = x;
        this.y = y;
    }
    var p = Point(7, 5); // 没有用new关键字去执行构造函数！
    
    console.log(p === undefined); // 没有用new，所以构造函数没有返回一个实例对象， 所以p === undefined
    
    // 没有用new关键字，Point(7,5);就只是把函数执行了一遍
    // ()左边是Point，属于全局对象，所以this指向全局对象
    console.log(x); // 7
    console.log(y); // 5
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="在事件处理器-event-handler-中this的指向"><a href="#在事件处理器-event-handler-中this的指向" class="header-anchor">#</a> 在事件处理器(event handler)中this的指向</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;div id=&quot;test&quot;&gt;I am an element with id #test&lt;/div&gt;

function doAlert() { 
    alert(this.innerHTML); 
} 

doAlert(); // undefined 
// doAlert()属于全局对象

var myElem = document.getElementById('test'); 
myElem.onclick = doAlert; 

alert(myElem.onclick === doAlert); // true 
myElem.onclick(); // I am an element
// ()左边是onclick也就是doAlert,属于myElem,所以this指向myElem
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>那个元素触发事件，this就指向那个元素</p> <h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <p>以上，对于函数中的<code>this</code>，通过查看<code>()</code>左边所属的对象去确定，真的很好用。</p> <p>而实质上，<code>this</code>是在创建函数的执行环境时，在创建阶段确定的，因此，弄透执行环境，去思考执行环境创建阶段的<code>this</code>的指向，<code>this</code>的指向就不会弄错了吧。</p> <p>因为箭头函数并没有 this，this 会作为变量一直向上级词法作用域查找，直至找到为止</p> <p>箭头函数中不会绑定<code>this</code>，由于JS采用词法作用域，所以箭头函数中的<code>this</code>只取决于其定义时的环境。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 输出： 10</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    foo<span class="token operator">:</span> foo
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 输出： 10</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 输出： 10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'window'</span>

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'person1'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">show1</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">show2</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">show3</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">show4</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'person2'</span> <span class="token punctuation">}</span>

person1<span class="token punctuation">.</span><span class="token function">show1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ？</span>
person1<span class="token punctuation">.</span><span class="token function">show1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span>  <span class="token comment">// ？</span>

person1<span class="token punctuation">.</span><span class="token function">show2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ？</span>
person1<span class="token punctuation">.</span><span class="token function">show2</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span>  <span class="token comment">// ？</span>

person1<span class="token punctuation">.</span><span class="token function">show3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ？</span>
person1<span class="token punctuation">.</span><span class="token function">show3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span>  <span class="token comment">// ？</span>
person1<span class="token punctuation">.</span><span class="token function">show3</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ？</span>

person1<span class="token punctuation">.</span><span class="token function">show4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ？</span>
person1<span class="token punctuation">.</span><span class="token function">show4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span>  <span class="token comment">// ？</span>
person1<span class="token punctuation">.</span><span class="token function">show4</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ？</span>


person1 <span class="token comment">// 函数作为对象方法调用，this指向对象</span>
person2 <span class="token comment">// 使用call间接调用函数，this指向传入的person2</span>
window  <span class="token comment">// 箭头函数无this绑定，在全局环境找到this，指向window</span>
window  <span class="token comment">// 间接调用改变this指向对箭头函数无效</span>
window  <span class="token comment">// person1.show3()返回普通函数，相当于普通函数调用，this指向window</span>
person2 <span class="token comment">// 使用call间接调用函数，this指向传入的person2</span>
window  <span class="token comment">// person1.show3.call(person2)仍然返回普通函数</span>
person1 <span class="token comment">// person1.show4调用对象方法，this指向person1，返回箭头函数，this在person1.show4调用时的词法环境中找到，指向person1</span>
person1  <span class="token comment">// 间接调用改变this指向对箭头函数无效</span>
person2  <span class="token comment">// 改变了person1.show4调用时this的指向，所以返回的箭头函数的内this解析改变</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h5 id="_1、箭头函数没有-this-绑定"><a href="#_1、箭头函数没有-this-绑定" class="header-anchor">#</a> 1、箭头函数没有 this 绑定</h5> <p>箭头函数中没有 <code>this</code> 绑定，必须通过查找作用域链来决定其值。如果箭头函数被非箭头函数包含，则 <code>this</code> 绑定的是最近一层非箭头函数的 <code>this</code> ；否则，<code>this</code> 的值会被设置为全局对象。</p> <p>或者再简单一点来说：<strong>箭头函数的 this 指向离它最近的父级作用域</strong> 。</p> <p>举个例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 普通函数
let person = {
    name: 'zhangsan',
    age: 18,
    say: function() {
        console.log(this); // person 对象
        console.log(this.name); // 'zhangsan'
        console.log(this.age);  // 18
    }
};

person.say(); // 普通函数，谁调用，this 指向谁
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>// 箭头函数
let person = {
    name: 'zhangsan',
    age: 18,
    say: () =&gt; {
        console.log(this); // window 对象
        console.log(this.name); // undefined
        console.log(this.age);  // undefined
    }
};

person.say(); // 箭头函数，没有 this，函数内部的 this，指向父级作用域，即全局
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="call-、apply-、bind"><a href="#call-、apply-、bind" class="header-anchor">#</a> call()、apply()、bind()</h2> <p>我们可以通过使用 <code>call()</code> 和 <code>apply()</code> 方法来实现;</p> <p>obj1.(method).call(obj2,argument1,argument2) 如上，call的作用就是把obj1的方法放到obj2上使用，后面的argument1..这些做为参数传入。</p> <p><code>JavaScript</code> 提供的大多数函数以及<strong>我们自己创建的所有函数</strong>都可以使用这两个方法;</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>fn.call(obj Object [, ...arguments])
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>第一个参数接收一个对象, 作为 <code>this</code> 关键字绑定的对象, 第二个参数是该函数传递的参数;</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>function foo(a, b) {
    console.log((a + b) * this.c)
}

var obj = {
    c: 2
}

foo.call(obj, 1, 2) // 6

// foo.apply(obj, [1, 2])
// call() 与 apply() 的效果完全一致, 唯一不同的只是传递参数的格式不同
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>指向传入的第一个参数</p> <blockquote><p>这里注意两点：</p> <ol><li><code>bind</code>返回一个函数，需要手动调用，<code>call</code>、<code>apply</code>会自动调用</li> <li>传入的第一个参数若为<code>undefined</code>或<code>null</code>，<code>this</code>指向全局对象</li></ol></blockquote> <p><code>call</code>，<code>apply</code>唯一的区别就是参数的传递形式，<code>apply</code>应该传递一个数组，<code>call</code>则应该单独传递参数。</p> <p>我们用<code>bind</code>来做同样的事情，<code>bind</code>返回一个新的方法，这个方法中的<code>this</code>指向传递的第一个参数。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>let person2Display = person.displayName.bind(person2);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <h2 id="javascript深入理解this关键字-二"><a href="#javascript深入理解this关键字-二" class="header-anchor">#</a> JavaScript深入理解this关键字(二)</h2> <p>原创 发疯的前端 [发疯的前端](javascript:void(0)😉 <em>4月27日</em></p> <h1 id="摘要"><a href="#摘要" class="header-anchor">#</a> 摘要</h1> <p>上一篇文章中，引入了为什么使用this,以及this中常见的误区和解决方案。接下来我就关于this的使用以及规则说一下，希望对读友有帮助。</p> <p><strong>1. 调用位置</strong></p> <p>在理解this的使用之前，先了解一个调用位置:函数在代码中调用的位置，这有助于我们理解this是指向谁。例子</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">debugger</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以上代码在浏览器中执行，我们可以通过浏览器的调试工具查看函数的调用顺序与this指向谁。这里效果图就不截取了。接下来就是this的规则。</p> <p><strong>2 绑定规则</strong></p> <p><strong>2.1 默认规则</strong></p> <p>首先看一下代码来自《你不知道的JavaScript》中。</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>function foo() {        console.log(this);        console.log(this.a);    }    var a = 'hello';    foo();//this-&gt;window,this.a-&gt;hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>预期结果就是输出window，hello。函数在自身调用的时候，其this指向的是全局对象window，这样被称之为默认规则。但这条默认规则，在严格模式下又是不可取的，如下代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> function foo() {        &quot;use strict&quot;;        console.log(this);        console.log(this.a);    }    var a = 'hello';    foo();//this-&gt;undefined,this.a-&gt;获取不到 undefined
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在严格模式下的函数中，函数在自身调用的时候，this的指向为undefined。</p> <p>但是，还有另外一种情况就是在严格模式下调用，依然会使用默认规则代码如下</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> function foo() {        console.log(this);        console.log(this.a);    }    var a = 'hello';
    (function () {        'use strict';        foo();//this-&gt;window,this.a-&gt;hello    })();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>2.2 隐式绑定</strong></p> <p>在隐式绑定中，可以理解为谁调用这个函数，this就指向谁。话不多说直接上代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> function foo() {        console.log(this.a);    }    var obj = {        a:2,        foo:foo    };    obj.foo();//2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过代码来看 其实一点不难理解,obj调用了这个函数，自然的this就指向了obj这个对象。其实换句话说就是谁直接调用这个函数，this就指向谁。在上代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>  function foo() {        console.log(this.a);    }    var obj2 = {        a:42,        foo:foo    };    var obj1 = {        a:2,        obj2:obj2    };    obj1.obj2.foo();//42
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码中，最终直接调用foo的是obj2，那么this.a就会获取obj2的a的值。</p> <p>在隐式绑定中，会出现一个问题，就是this绑定丢失的问题。上代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> function foo() {       console.log(this.a);   }   var obj = {       a:2,       foo:foo   };   var bar = obj.foo;   var a = 'oops,global';   bar();//oops,global
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们预期的运行结果是this.a=2；但是实际结果是oops,global;在代码中虽然我们用bar引用了obj.foo这个属性，但实际上是引用了foo这个函数。因此最后调用bar()和调用foo()是一个道理,最后this指向了window。应用了默认绑定在非严格模式下的规则。</p> <p><strong>2.3 显式绑定</strong></p> <p>在隐式绑定中，我们是通过让函数绑定到对象中的某个属性来实现this的指向，这个容易造成this指向的丢失。为了解决这个问题，我们通过显式绑定的方式解决。在JavaScript中的函数中都有两个方法call与apply可以通过调用z这两个方法强制改变this的指向。这种方式我们称之为显式绑定。</p> <p>实例直接上代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>function foo(){        console.log( this.a );    }    var obj = {        a:2    };    foo.call(obj);//2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>2.3.1 硬绑定</strong></p> <p>在显式绑定中的一种方式就是硬绑定，一旦绑定成功不会受调用他的对象影响。上代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> function foo() {        console.log( this.a );    }    var obj = {        a:2    };    var bar = function () {        foo.call(obj);    };    bar.call(window);//2    setTimeout(bar,100);//2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这段代码中，我们看到了foo绑定了obj，让this指向了obj。在调用foo的函数中bar也改变了this的指向。但对于运行的预期结果没有影响。</p> <p><strong>2.3.2 API调用的&quot;上下文&quot;</strong></p> <p>在第三方库中的许多函数，以及JavaScript和宿主环境中的许多新的内置函数，都提供了一个可选的参数，来指定this。上代码</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>function foo(el) {    console.log(el,this.id);}var obj = {    id:&quot;awesome&quot;};//调用foo(...)时把this绑定到obj[1,2,3].forEach(foo,obj);//1 &quot;awesome&quot;  2 &quot;awesome&quot; 3 &quot;awesome&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>类似的forEach内置的函数实际上是通过call和apply来实现绑定的。</p> <p><strong>2.4 new 绑定</strong></p> <p>在JavaScript中new操作符合其他语言的new有很大的区别。一个函数通过new 调用的时候，其实并不是真正的类的调用，这里模仿了java中类的调用，可以称之为虚拟类吧。JavaScript的new一次其实进行了很多操作这里就不赘述了。下面直接上代码，看看new是怎么绑定this的</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>function foo(a) {        this.a = a;    }    var bar = new foo(2);    console.log(bar.a);//2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一句话，就是这么简单。bar引用了new调用的foo;那么this就绑定到了bar上。</p> <p><strong>总结</strong></p> <p>关于this部分，暂时讲解到这里，这里面可能或多或少讲解的也并不是那么透彻，但算是给自己做个小笔记以后方便自己查阅，哪里有不正确的地方还希望朋友们帮忙指正。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/11/2020, 7:52:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/computer/JavaScript/Symbol.html" class="prev">
        Symbol
      </a></span> <span class="next"><a href="/computer/JavaScript/事件.html">
        事件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><BackToTop></BackToTop></div></div>
    <script src="/assets/js/app.fcebdc86.js" defer></script><script src="/assets/js/2.566d03f3.js" defer></script><script src="/assets/js/27.defabb34.js" defer></script>
  </body>
</html>
